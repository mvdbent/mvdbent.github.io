<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CIS-Script | AppleShare IT</title><meta name=keywords content="CIS,Benchmark,Reporting,macOS,Security,Jamf Pro"><meta name=description content="This CIS Script is build to report and remediate based on the your organisation score.
While working with CIS Benchmarks (Remediation Scripts and/or Configuration Profiles) I felt this could be done better, faster and easier. The guys from the macOS Security Compliance Project did an amazing job automating the guidance and configuration profiles.
I created custom rules set for CIS Benchmark to integrate with the macOS Security Compliance Project and published CIS-macOS-Security."><meta name=author content><link rel=canonical href=https://appleshare.it/posts/cis-script/><link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://appleshare.it/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://appleshare.it/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://appleshare.it/favicon-32x32.png><link rel=apple-touch-icon href=https://appleshare.it/apple-touch-icon.png><link rel=mask-icon href=https://appleshare.it/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.110.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="CIS-Script"><meta property="og:description" content="This CIS Script is build to report and remediate based on the your organisation score.
While working with CIS Benchmarks (Remediation Scripts and/or Configuration Profiles) I felt this could be done better, faster and easier. The guys from the macOS Security Compliance Project did an amazing job automating the guidance and configuration profiles.
I created custom rules set for CIS Benchmark to integrate with the macOS Security Compliance Project and published CIS-macOS-Security."><meta property="og:type" content="article"><meta property="og:url" content="https://appleshare.it/posts/cis-script/"><meta property="og:image" content="https://appleshare.it/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-03T00:00:00+00:00"><meta property="article:modified_time" content="2021-10-03T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://appleshare.it/papermod-cover.png"><meta name=twitter:title content="CIS-Script"><meta name=twitter:description content="This CIS Script is build to report and remediate based on the your organisation score.
While working with CIS Benchmarks (Remediation Scripts and/or Configuration Profiles) I felt this could be done better, faster and easier. The guys from the macOS Security Compliance Project did an amazing job automating the guidance and configuration profiles.
I created custom rules set for CIS Benchmark to integrate with the macOS Security Compliance Project and published CIS-macOS-Security."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://appleshare.it/posts/"},{"@type":"ListItem","position":2,"name":"CIS-Script","item":"https://appleshare.it/posts/cis-script/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CIS-Script","name":"CIS-Script","description":"This CIS Script is build to report and remediate based on the your organisation score.\nWhile working with CIS Benchmarks (Remediation Scripts and/or Configuration Profiles) I felt this could be done better, faster and easier. The guys from the macOS Security Compliance Project did an amazing job automating the guidance and configuration profiles.\nI created custom rules set for CIS Benchmark to integrate with the macOS Security Compliance Project and published CIS-macOS-Security.","keywords":["CIS","Benchmark","Reporting","macOS","Security","Jamf Pro"],"articleBody":" This CIS Script is build to report and remediate based on the your organisation score.\nWhile working with CIS Benchmarks (Remediation Scripts and/or Configuration Profiles) I felt this could be done better, faster and easier. The guys from the macOS Security Compliance Project did an amazing job automating the guidance and configuration profiles.\nI created custom rules set for CIS Benchmark to integrate with the macOS Security Compliance Project and published CIS-macOS-Security.\nWhile working with CIS Benchmark, Script and Configuration Profile, I had the feeling there was missing a overview with compleet reporting, and there for build a read only CIS-Reporting script you can find here\nEnded up with seperate tools, creation of the Documention, Configuration Profiles and Reporting. However I still needed an extra script for remediation.\nTo resolve this I combined the reporting script with remediation with the option to enable remediation or not.\nAnd we need to keep in mind that every year we get a new macOS release and like macOS, Security is a moving target. Basically things change, and we don’t want to edit and maintain an 3000 line script. This will be hard to maintain if a new macOS has released.\nFor that reason, and for easy maintaining, the CIS-Script is assembled out of a bunch of fragments.\nHere structure of the CIS Script folder, in the root of the folder, there is a symbolic link to the assemble script. The original is in the Utils folder, with some other script you can use. All script that you assamble/create will be stored in the Build folder. For implementation into the jamf pro server there are some resources in the Jamf Folder.\nIn the Fragments folder. Here you will have the Header.sh, Footer.sh and Version.sh files with all the logic and functions that will be assembled into the script. In the OrgScore Folder are all the separate CIS Benchmark OrgScore*.sh. Every CIS Benchmark orgScore you can test separately if you need to trouble shoot or extend it with the new macOS.\nCIS Benchmark OrgScore Let’s have a look how the CIS Benchmark OrgScore, looks like.\n#!/bin/zsh script_dir=$(dirname ${0:A}) projectfolder=$(dirname $script_dir) source ${projectfolder}/Header.sh CISLevel=\"1\" audit=\"2.1.1 Turn off Bluetooth, if no paired devices exist (Automated)\" orgScore=\"OrgScore2_1_1\" emptyVariables # Verify organizational score runAudit # If organizational score is 1 or true, check status of client if [[ \"${auditResult}\" == \"1\" ]]; then method=\"Script\" remediate=\"Script - defaults write /Library/Preferences/com.apple.Bluetooth ControllerPowerState -bool false\" connectable=$(system_profiler SPBluetoothDataType 2\u003e\u00261 | grep -c \"Paired: Yes\") bluetoothEnabled=$(defaults read /Library/Preferences/com.apple.Bluetooth ControllerPowerState -bool) comment=\"Paired Devices: ${connectable}\" # if [[ \"$connectable\" == 0 ]] \u0026\u0026 [[ \"$bluetoothEnabled\" == 0 ]]; then if [[ \"$connectable\" -gt 0 ]] \u0026\u0026 [[ \"$bluetoothEnabled\" == 1 ]] || [[ \"$connectable\" == 0 ]] \u0026\u0026 [[ \"$bluetoothEnabled\" == 0 ]]; then result=\"Passed\" else result=\"Failed\" comment=\"No Paired Devices” # Remediation if [[ \"${remediateResult}\" == \"enabled\" ]]; then defaults write /Library/Preferences/com.apple.Bluetooth ControllerPowerState -bool false killall -HUP bluetoothd # re-check connectable=$(system_profiler SPBluetoothDataType 2\u003e\u00261 | grep -c \"Paired: Yes\") bluetoothEnabled=$(defaults read /Library/Preferences/com.apple.Bluetooth ControllerPowerState -bool) if [[ \"$connectable\" == 0 ]] \u0026\u0026 [[ \"$bluetoothEnabled\" == 0 ]]; then result=\"Passed After Remediation\" else result=\"Failed After Remediation\" fi fi fi fi printReport We runAudit to verify the organizational score. If scored we perform an audit to check the state. Then Check if remediateResult is enabled, and if enabled we remediate, we perform an audit to check if remediation succeeded and report back so we can read this out in report\nTo some up what the org score is doing, is Audit, Remediate and report.\nFor adjustments or testing, you can run every OrgScore seperatly.\n$ cd /Git/CIS-Script/Fragments/OrgScores $ sudo ./OrgScore*.sh Custom CIS Benchmark OrgScore You can make your own custom OrgScore, which you can include into the CIS-Script. Make sure that the name of the file is the same as the OrgScore within the script.\nPlace your custom OrgScore in the Framework/OrgScore folder.\nAssemble Remediation Script To assemble all the fragements together in a full Script CISBenchmarkScript.sh which you can use standalone or via an MDM server (like Jamf Pro) you can use the Assemble.sh script.\nThe Assemble.sh will default build the full Remediation Script CISBenchmarkScript.sh.\n$ ./Assemble.sh You can create seperate script by running the script with -s [–separate] option\n$ ./Assemble.sh -s With the following command ./Assemble.sh -h you can read about the options.\nThe following options are available: -j --json Builds Jamf Pro Custom Schema.json file -s --separate Builds separate CIS Benchmark Script from the fragements -h --help Displays this message or details on a specific verb EXAMPLES ./Assemble.sh Builds CIS Benchmark Script from the fragements ./Assemble.sh -j Builds Jamf Pro Custom Schema.json file ./Assemble.sh -s Builds separate CIS Benchmark Script from the fragements The Assemble.sh script will built the full script in ./Build/ and the seperate scripts in ./Build/Scripts/ folder.\nCIS Benchmark Script The CISBenchmarkScript.sh Script can be run as a local standalone script, and will preform a read only audit which creates a full report. Location of the report /Library/Security/Reports/\n$ sudo ./CISBenchmarkScript.sh You can create a Full Report by running the script with -f [–fullreport] option\n$ sudo ./CISBenchmarkScript.sh -f You can enable remediation by running the script with -r [–remediate] option\n$ sudo ./CISBenchmarkScript.sh -r With the following command ./Build/CISBenchmarkScript.sh -h you can read about the options.\nThe following options are available: -f\t--fullreport\tPrint Full Report -h\t--help\tDisplays this message or details on a specific verb -r\t--remediate\tEnable Remediation EXAMPLES ./CISBenchmarkScript.sh -f Run script to print Full Report ./CISBenchmarkScript.sh -r Run script with Remediation enabled ./CISBenchmarkScript.sh -rf Run script with Remediation enabled and print Full Report Implementation Jamf Pro Server Upload the assembled CISBenchmarkScript.sh Script into the Jamf Pro Server.\nUpload the Extension Atrributes into you Jamf Pro Server. Location Extension Atrributes\nCIS Benchmark Settings Configuration Profile If you use the script via a Jamf Pro you can set the script to create a short or full report, and enable or disable remediation. By using a mobile config we can control and set the organisation scoring and CIS script settings.\nFor easy creation of the CIS script Configure profile, you can use the Assemble.sh script with -j [–json] option to generate an JSON Schema manifests from all the fragments in OrgScores folder (including custom OrgScores).\n$ sudo ./CISBenchmarkScript.sh -j Create a new computer configuration profile, give the profile a name and add the policy to a categorie, within the Application \u0026 Custom Settings payload, upload the just generated Custom Schema.json file, make sure that you check if you upload the just created file, Fill in the preference domain.\nNow you can configure what you need the CIS script to do, full or short report, remediation enabled or not, and go through the list and enable/disable the org scores where you need to score on.\nAfter we uploaded the CIS scripts, Configuration profile and Extension Attribute into the Jamf Pro Server, the last thing we need to do is, to create a policy. Create a new policy, choose the preferred trigger, set the preferred frequency, add the CIS Script and don’t forget to scope.\nAfter you scoped the CIS script Configure profile and the Policy with the script to the Target Devices.\nYou are ready to get compliant and know the state of your devices Resources github.com/mvdbent/CIS-Script\n","wordCount":"1206","inLanguage":"en","datePublished":"2021-10-03T00:00:00Z","dateModified":"2021-10-03T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://appleshare.it/posts/cis-script/"},"publisher":{"@type":"Organization","name":"AppleShare IT","logo":{"@type":"ImageObject","url":"https://appleshare.it/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://appleshare.it/ accesskey=h title="AppleShare IT (Alt + H)">AppleShare IT</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://appleshare.it/about/ title=About><span>About</span></a></li><li><a href=https://appleshare.it/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://appleshare.it/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://appleshare.it/links/ title=Links><span>Links</span></a></li><li><a href=https://appleshare.it/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>CIS-Script</h1><div class=post-meta>October 3, 2021&nbsp;·&nbsp;6 min</a></div></header><div class=post-content><figure class=align-center><a href=https://github.com/mvdbent/CIS-Script target=_blank><img loading=lazy src=/img/CIS-Script.png#center height=300></a></figure><p><img loading=lazy src=https://img.shields.io/badge/macOS-11-success alt=GitHub>
<img loading=lazy src=https://img.shields.io/badge/macOS-12-success alt=GitHub></p><p>This CIS Script is build to report and remediate based on the your organisation score.</p><p>While working with CIS Benchmarks (Remediation Scripts and/or Configuration Profiles) I felt this could be done better, faster and easier.
The guys from the <a href=https://github.com/usnistgov/macos_security target=_blank rel=noopener>macOS Security Compliance Project</a> did an amazing job automating the guidance and configuration profiles.</p><p>I created custom rules set for <em><a href=https://downloads.cisecurity.org/#/ target=_blank rel=noopener>CIS Benchmark</a></em> to integrate with the macOS Security Compliance Project and published <a href=https://github.com/mvdbent/CIS-macOS-Security target=_blank rel=noopener>CIS-macOS-Security</a>.</p><p>While working with <strong>CIS Benchmark</strong>, <strong>Script</strong> and <strong>Configuration Profile</strong>, I had the feeling there was missing a overview with compleet reporting, and there for build a read only CIS-Reporting script you can find <a href=https://github.com/mvdbent/CIS-Reporting target=_blank rel=noopener>here</a></p><p>Ended up with seperate tools, creation of the <strong>Documention</strong>, <strong>Configuration Profiles</strong> and <strong>Reporting</strong>. However I still needed an extra script for remediation.</p><p>To resolve this I combined the reporting script with remediation with the option to enable remediation or not.</p><p>And we need to keep in mind that every year we get a new macOS release and like macOS, Security is a moving target.
Basically things change, and we don&rsquo;t want to edit and maintain an 3000 line script. This will be hard to maintain if a new macOS has released.</p><p>For that reason, and for easy maintaining, the CIS-Script is assembled out of a bunch of fragments.</p><figure class=align-center><img loading=lazy src=/img/folder.jpeg#center></figure><p>Here structure of the CIS Script folder, in the root of the folder, there is a symbolic link to the assemble script. The original is in the Utils folder, with some other script you can use. All script that you assamble/create will be stored in the Build folder. For implementation into the jamf pro server there are some resources in the Jamf Folder.</p><p>In the Fragments folder. Here you will have the <code>Header.sh</code>, <code>Footer.sh</code> and <code>Version.sh</code> files with all the logic and functions that will be assembled into the script.
In the <strong>OrgScore</strong> Folder are all the separate CIS Benchmark <code>OrgScore*.sh</code>. Every CIS Benchmark orgScore you can test separately if you need to trouble shoot or extend it with the new macOS.</p><h3 id=cis-benchmark-orgscore>CIS Benchmark OrgScore<a hidden class=anchor aria-hidden=true href=#cis-benchmark-orgscore>#</a></h3><p>Let&rsquo;s have a look how the CIS Benchmark OrgScore, looks like.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#75715e>#!/bin/zsh
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>script_dir<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>dirname <span style=color:#e6db74>${</span>0:A<span style=color:#e6db74>}</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>projectfolder<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>dirname $script_dir<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>source <span style=color:#e6db74>${</span>projectfolder<span style=color:#e6db74>}</span>/Header.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CISLevel<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>audit<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2.1.1 Turn off Bluetooth, if no paired devices exist (Automated)&#34;</span>
</span></span><span style=display:flex><span>orgScore<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;OrgScore2_1_1&#34;</span>
</span></span><span style=display:flex><span>emptyVariables
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Verify organizational score</span>
</span></span><span style=display:flex><span>runAudit
</span></span><span style=display:flex><span><span style=color:#75715e># If organizational score is 1 or true, check status of client</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>auditResult<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;1&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    method<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Script&#34;</span>
</span></span><span style=display:flex><span>    remediate<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Script - defaults write /Library/Preferences/com.apple.Bluetooth ControllerPowerState -bool false&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    connectable<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>system_profiler SPBluetoothDataType 2&gt;&amp;<span style=color:#ae81ff>1</span> | grep -c <span style=color:#e6db74>&#34;Paired: Yes&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    bluetoothEnabled<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>defaults read /Library/Preferences/com.apple.Bluetooth ControllerPowerState -bool<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    comment<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Paired Devices: </span><span style=color:#e6db74>${</span>connectable<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># if [[ &#34;$connectable&#34; == 0 ]] &amp;&amp; [[ &#34;$bluetoothEnabled&#34; == 0 ]]; then</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$connectable<span style=color:#e6db74>&#34;</span> -gt <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$bluetoothEnabled<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>]]</span> <span style=color:#f92672>||</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$connectable<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$bluetoothEnabled<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        result<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Passed&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        result<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Failed&#34;</span>
</span></span><span style=display:flex><span>        comment<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;No Paired Devices”
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # Remediation
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if [[ &#34;</span><span style=color:#e6db74>${</span>remediateResult<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34; == &#34;</span>enabled<span style=color:#e6db74>&#34; ]]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            defaults write /Library/Preferences/com.apple.Bluetooth ControllerPowerState -bool false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            killall -HUP bluetoothd
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            # re-check
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            connectable=</span><span style=color:#66d9ef>$(</span>system_profiler SPBluetoothDataType 2&gt;&amp;<span style=color:#ae81ff>1</span> | grep -c <span style=color:#e6db74>&#34;Paired: Yes&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            bluetoothEnabled=</span><span style=color:#66d9ef>$(</span>defaults read /Library/Preferences/com.apple.Bluetooth ControllerPowerState -bool<span style=color:#66d9ef>)</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            if [[ &#34;</span>$connectable<span style=color:#e6db74>&#34; == 0 ]] &amp;&amp; [[ &#34;</span>$bluetoothEnabled<span style=color:#e6db74>&#34; == 0 ]]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                result=&#34;</span>Passed After Remediation<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                result=&#34;</span>Failed After Remediation<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>printReport
</span></span></span></code></pre></div><p>We <code>runAudit</code> to verify the organizational score. If scored we perform an audit to check the state.
Then Check if <code>remediateResult</code> is enabled, and if enabled we remediate, we perform an audit to check if remediation succeeded and report back so we can read this out in report</p><p>To some up what the org score is doing, is <code>Audit</code>, <code>Remediate</code> and <code>report</code>.</p><p>For adjustments or testing, you can run every OrgScore seperatly.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>$ cd /Git/CIS-Script/Fragments/OrgScores
</span></span><span style=display:flex><span>$ sudo ./OrgScore*.sh
</span></span></code></pre></div><h3 id=custom-cis-benchmark-orgscore>Custom CIS Benchmark OrgScore<a hidden class=anchor aria-hidden=true href=#custom-cis-benchmark-orgscore>#</a></h3><p>You can make your own custom <code>OrgScore</code>, which you can include into the CIS-Script.
Make sure that the name of the file is the same as the <code>OrgScore</code> within the script.</p><p>Place your custom <code>OrgScore</code> in the <code>Framework/OrgScore</code> folder.</p><h3 id=assemble-remediation-script>Assemble Remediation Script<a hidden class=anchor aria-hidden=true href=#assemble-remediation-script>#</a></h3><p>To assemble all the fragements together in a full Script <code>CISBenchmarkScript.sh</code> which you can use standalone or via an MDM server (like Jamf Pro) you can use the <code>Assemble.sh</code> script.</p><p>The <code>Assemble.sh</code> will default build the full Remediation Script <code>CISBenchmarkScript.sh</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./Assemble.sh
</span></span></code></pre></div><p>You can create seperate script by running the script with -s [&ndash;separate] option</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./Assemble.sh -s
</span></span></code></pre></div><p>With the following command <code>./Assemble.sh -h</code> you can read about the options.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>The following options are available:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  -j  --json      Builds Jamf Pro Custom Schema.json file
</span></span><span style=display:flex><span>  -s  --separate  Builds separate CIS Benchmark Script from the fragements
</span></span><span style=display:flex><span>  -h  --help      Displays this message or details on a specific verb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>EXAMPLES
</span></span><span style=display:flex><span>  ./Assemble.sh
</span></span><span style=display:flex><span>      Builds CIS Benchmark Script from the fragements
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ./Assemble.sh -j
</span></span><span style=display:flex><span>      Builds Jamf Pro Custom Schema.json file
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ./Assemble.sh -s
</span></span><span style=display:flex><span>      Builds separate CIS Benchmark Script from the fragements
</span></span></code></pre></div><p>The <code>Assemble.sh</code> script will built the full script in <code>./Build/</code> and the seperate scripts in <code>./Build/Scripts/</code> folder.</p><h3 id=cis-benchmark-script>CIS Benchmark Script<a hidden class=anchor aria-hidden=true href=#cis-benchmark-script>#</a></h3><p>The <code>CISBenchmarkScript.sh</code> Script can be run as a local standalone script, and will preform a read only audit which creates a full report. Location of the report <code>/Library/Security/Reports/</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo ./CISBenchmarkScript.sh
</span></span></code></pre></div><p>You can create a Full Report by running the script with -f [&ndash;fullreport] option</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo ./CISBenchmarkScript.sh -f
</span></span></code></pre></div><p>You can enable remediation by running the script with -r [&ndash;remediate] option</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo ./CISBenchmarkScript.sh -r
</span></span></code></pre></div><p>With the following command <code>./Build/CISBenchmarkScript.sh -h</code> you can read about the options.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>The following options are available:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	-f	--fullreport	Print Full Report
</span></span><span style=display:flex><span>	-h	--help			Displays this message or details on a specific verb
</span></span><span style=display:flex><span>	-r	--remediate		Enable Remediation
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>EXAMPLES
</span></span><span style=display:flex><span>    ./CISBenchmarkScript.sh -f
</span></span><span style=display:flex><span>            Run script to print Full Report
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ./CISBenchmarkScript.sh -r
</span></span><span style=display:flex><span>            Run script with Remediation enabled
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ./CISBenchmarkScript.sh -rf
</span></span><span style=display:flex><span>            Run script with Remediation enabled and print Full Report
</span></span></code></pre></div><h3 id=implementation-jamf-pro-server>Implementation Jamf Pro Server<a hidden class=anchor aria-hidden=true href=#implementation-jamf-pro-server>#</a></h3><p>Upload the assembled <code>CISBenchmarkScript.sh</code> Script into the Jamf Pro Server.</p><p>Upload the Extension Atrributes into you Jamf Pro Server.
Location <a href=https://github.com/mvdbent/CIS-Script/tree/main/Jamf/EA target=_blank rel=noopener>Extension Atrributes</a></p><h4 id=cis-benchmark-settings-configuration-profile>CIS Benchmark Settings Configuration Profile<a hidden class=anchor aria-hidden=true href=#cis-benchmark-settings-configuration-profile>#</a></h4><p>If you use the script via a Jamf Pro you can set the script to create a short or full report, and enable or disable remediation. By using a mobile config we can control and set the organisation scoring and CIS script settings.</p><p>For easy creation of the CIS script Configure profile, you can use the <code>Assemble.sh</code> script with -j [&ndash;json] option to generate an <code>JSON Schema manifests</code> from all the fragments in OrgScores folder (including custom OrgScores).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo ./CISBenchmarkScript.sh -j
</span></span></code></pre></div><p>Create a new computer configuration profile, give the profile a name and add the policy to a categorie, within the Application & Custom Settings payload, upload the just generated Custom Schema.json file, make sure that you check if you upload the just created file, Fill in the preference domain.</p><p>Now you can configure what you need the CIS script to do, full or short report, remediation enabled or not, and go through the list and enable/disable the org scores where you need to score on.</p><p>After we uploaded the CIS scripts, Configuration profile and Extension Attribute into the Jamf Pro Server, the last thing we need to do is, to create a policy. Create a new policy, choose the preferred trigger, set the preferred frequency, add the CIS Script and don’t forget to scope.</p><p>After you scoped the CIS script Configure profile and the Policy with the script to the Target Devices.</p><h2 style=color:#3fc69b>You are ready to get compliant and know the state of your devices</h2><h3 id=resources>Resources<a hidden class=anchor aria-hidden=true href=#resources>#</a></h3><p><a href=https://github.com/mvdbent/CIS-Script target=_blank rel=noopener><strong>github.com/mvdbent/CIS-Script</strong></a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://appleshare.it/tags/cis/>CIS</a></li><li><a href=https://appleshare.it/tags/benchmark/>Benchmark</a></li><li><a href=https://appleshare.it/tags/reporting/>Reporting</a></li><li><a href=https://appleshare.it/tags/macos/>macOS</a></li><li><a href=https://appleshare.it/tags/security/>Security</a></li><li><a href=https://appleshare.it/tags/jamf-pro/>Jamf Pro</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://appleshare.it/>AppleShare IT</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>